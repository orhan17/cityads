# CityAds Offers Service

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π **Symfony**‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (PHP 8+), –∫–æ—Ç–æ—Ä–æ–µ:

1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –æ—Ñ—Ñ–µ—Ä—ã –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (CityAds API).
2. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (MySQL).
3. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç **JSON API** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ñ—Ñ–µ—Ä–æ–≤ –ø–æ GEO –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ GEO.
4. –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—Ñ—Ñ–µ—Ä—ã –ø–æ –∑–∞–ø—Ä–æ—Å—É.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Docker** –∏ **docker compose** (–≤–µ—Ä—Å–∏–∏ –Ω–µ –Ω–∏–∂–µ 3).
- –£ –≤–∞—Å –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –ø–æ—Ä—Ç–æ–≤, —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –≤ `docker-compose.yml` –¥–ª—è MySQL, Nginx –∏ phpMyAdmin.

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

1. **–°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**:

   ```bash
   git clone https://github.com/orhan17/cityads.git
   cd cityads
   ```

2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env` (–≤–Ω—É—Ç—Ä–∏ –ø–∞–ø–∫–∏ `src/`):
   ```bash
   cp src/.env.example src/.env
   cp .env.example .env
   ```
   
3. **–°–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –≤ `.env`, —É–∫–∞–∑–∞–≤ –¥–∞–Ω–Ω—ã–µ –¥–ª—è MySQL –∏ –ø—Ä–æ—á–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `MYSQL_ROOT_PASSWORD`, `MYSQL_DATABASE`, `MYSQL_USER`, `MYSQL_PASSWORD` –∏ —Ç. –¥.).

4. **–°–æ–±–µ—Ä–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ** –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:

   ```bash
   docker compose down && docker compose up --build
   ```

5. **–£–±–µ–¥–∏—Ç–µ—Å—å**, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–æ–¥–Ω—è–ª–∏—Å—å:

   ```bash
   docker compose ps
   ```
   
6. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
    ```bash
    docker compose exec app bash
    composer install
    ```

7. **–ó–∞–π–¥–∏—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ** –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:8000` (–µ—Å–ª–∏ `NGINX_PORT` = 8000). –î–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã—Ç—å—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–∞—à–µ–≥–æ Symfony‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–∏–ª–∏ 404, –µ—Å–ª–∏ –Ω–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ —Ä–æ—É—Ç–∏–Ω–≥–∞).

## –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

–í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Doctrine Migrations. –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
docker compose exec app bash
php bin/console make:migration
php bin/console doctrine:migrations:migrate
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –≤–∞—à–∏–º —Å—É—â–Ω–æ—Å—Ç—è–º (`Offer`, `Geo` –∏ —Ç. –¥.).

## –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ—Ñ—Ñ–µ—Ä–æ–≤

1. –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç `POST /sync-offers`.
    - –ï—Å–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É–∂–µ –∑–∞–ø—É—â–µ–Ω–∞, –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –æ—à–∏–±–∫—É (409 –∏–ª–∏ 400).

2. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ (–∏–ª–∏ –ø–æ –∂–µ–ª–∞–Ω–∏—é) –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å `syncOffers()` –≤ –∫–æ–Ω—Å–æ–ª–∏ (–µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –∫–æ–Ω—Å–æ–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä):
   ```bash
   docker compose exec app bash
   php bin/console app:sync-cityads
   ```
   –≠—Ç–æ –ø–æ–¥—Ç—è–Ω–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ CityAds –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç –∏—Ö –≤ –±–∞–∑–µ (–∫—Ä–æ–º–µ —Ç–µ—Ö, —á—Ç–æ —Å geo=Wrld).

## API-–º–µ—Ç–æ–¥—ã

1. **GET `/offers/{geo}`**
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
    - `page` (int, default=1)
    - `limit` (int, default=5, max=20)
- **–û–ø–∏—Å–∞–Ω–∏–µ:**  
  –û—Ç–¥–∞—ë—Ç —Å–ø–∏—Å–æ–∫ –æ—Ñ—Ñ–µ—Ä–æ–≤ –ø–æ –∫–æ–¥—É GEO, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ —É–±—ã–≤–∞–Ω–∏—é `rating`.
- **–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
  ```json
  {
    "data": [
      {
        "id": 1,
        "name": "Test Offer",
        "currencyName": "RUB",
        "rating": 250.5,
        "siteUrl": "https://...",
        "logo": "//..."
      }
    ],
    "total": 1,
    "page": 1,
    "limit": 5
  }
  ```
- **–û—à–∏–±–∫–∏:**
    - –ï—Å–ª–∏ –Ω–µ—Ç –æ—Ñ—Ñ–µ—Ä–æ–≤ –∏–ª–∏ GEO –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω ‚Äì 404.

üì∑ **–ü—Ä–∏–º–µ—Ä —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ –æ—Ç–≤–µ—Ç–∞:**  
![Screenshot1](screenshot1.png)

2. **GET `/geo-stats`**
- **–û–ø–∏—Å–∞–Ω–∏–µ:**  
  –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ —Å—Ç—Ä–∞–Ω–∞–º –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –æ—Ñ—Ñ–µ—Ä–æ–≤.
  - **–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
    ```json
    [
      {
        "code": "RU",
        "name": "Russia",
        "offersCount": 10
      },
      {
        "code": "US",
        "name": "United States",
        "offersCount": 2
      }
    ]
    ```

  üì∑ **–ü—Ä–∏–º–µ—Ä —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ –æ—Ç–≤–µ—Ç–∞:**  
  ![Screenshot2](screenshot2.png)

3. **POST `/sync-offers`**
    - –ó–∞–ø—É—Å–∫–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ñ—Ñ–µ—Ä–æ–≤ –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ API.
    - –ï—Å–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É–∂–µ –∏–¥—ë—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ.
    - –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –∑–∞–ø—É—Å–∫–µ ‚Äî `{"message":"–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ"}`.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (PHPUnit)

1. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞** (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ):
   ```bash
   docker compose exec app bash
   composer require --dev phpunit/phpunit
   ```

2. **–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤**:
   ```bash
   docker compose exec app bash
   php bin/phpunit
   ```
   –¢–µ—Å—Ç—ã –º–æ–≥—É—Ç –≤–∫–ª—é—á–∞—Ç—å:
    - **Unit-—Ç–µ—Å—Ç—ã** (–ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤, –±–µ–∑ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –ë–î).
    - **Functional-—Ç–µ—Å—Ç—ã** (–æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞–º, –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–µ—Å—Ç–æ–≤—É—é –ë–î).
    - **Integration-—Ç–µ—Å—Ç—ã** (–≤ —Ç–æ–º —á–∏—Å–ª–µ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ –≤–Ω–µ—à–Ω–µ–º—É API CityAds).

## OpenAPI-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

```
http://localhost:8000/docs/openapi.yml
```
–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤ [Swagger Editor](https://editor.swagger.io/) –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞.

---

**–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è!**

### üì© –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã, –ø–∏—à–∏—Ç–µ –≤ –º–æ–π Telegram-–∫–∞–Ω–∞–ª: [@ahmedovorxan](https://t.me/ahmedovorxan)